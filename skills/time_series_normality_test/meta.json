{
    "skill_folder_name": "time_series_normality_test",
    "skill_md_content": "---\nname: 时间序列数据的正态性检验\ndescription: 用于检验时间序列数据是否服从正态分布的工具，提供多种统计检验方法（Shapiro-Wilk、Kolmogorov-Smirnov、Jarque-Bera）及可视化（Q-Q图），帮助判断数据是否满足正态性假设，为后续统计分析提供依据。\nauthor: Doubao-1.8\nversion: 1.0.0\ntrigger:\n  - 检验时间序列正态性\n  - 时间序列是否服从正态分布\n  - 时间序列数据正态性检验\n  - 判断时间序列数据分布类型\noutput_format: |\n  {\n      \"shapiro_wilk\": {\"statistic\": 数值, \"p_value\": 数值, \"conclusion\": \"结论\"},\n      \"kolmogorov_smirnov\": {\"statistic\": 数值, \"p_value\": 数值, \"conclusion\": \"结论\"},\n      \"jarque_bera\": {\"statistic\": 数值, \"p_value\": 数值, \"conclusion\": \"结论\"},\n      \"qq_plot\": \"生成状态\",\n      \"overall_conclusion\": \"综合结论\",\n      \"significance_level\": 显著性水平\n  }\n---\n\n## 工作流程\n1. **数据输入**：提供待检验的时间序列数据（支持Pandas Series或Numpy数组格式）。\n2. **数据预处理**：自动检查并提示缺失值（需用户预先处理缺失数据）。\n3. **检验方法选择**：根据样本量自动适配检验方法，包括：\n   - Shapiro-Wilk检验（适用于样本量≤5000的小样本）\n   - Kolmogorov-Smirnov检验（适用于大样本，使用样本均值和标准差作为参数估计）\n   - Jarque-Bera检验（基于偏度和峰度的检验）\n4. **执行检验**：计算各检验的统计量和p值，生成Q-Q图（可选）。\n5. **结果输出**：返回各检验的详细结果及综合结论，判断数据是否服从正态分布。\n\n## 约束条件\n1. **样本量限制**：Shapiro-Wilk检验在样本量超过5000时结果可靠性下降，此时将自动跳过该检验。\n2. **独立性假设**：Jarque-Bera检验假设数据独立，若时间序列存在自相关，检验结果可能不准确，需先进行自相关检验。\n3. **缺失值处理**：输入数据不能包含缺失值，需用户预先通过插值、删除等方式处理。\n4. **显著性水平**：默认使用0.05作为显著性水平，用户可根据需求调整。\n\n## 工具使用\n本技能的Python实现位于`scripts/model.py`，提供了`time_series_normality_test`函数，可直接调用执行时间序列数据的正态性检验。函数支持自定义显著性水平及是否生成Q-Q图，返回结构化的检验结果字典。",
    "python_code": "import numpy as np\nimport pandas as pd\nfrom scipy import stats\nimport matplotlib.pyplot as plt\n\ndef time_series_normality_test(ts_data, plot_qq=True, significance_level=0.05):\n    \"\"\"\n    时间序列数据的正态性检验函数\n    \n    参数:\n        ts_data: pandas Series 或 numpy array，待检验的时间序列数据\n        plot_qq: bool，是否生成Q-Q图，默认为True\n        significance_level: float，显著性水平，默认为0.05\n    \n    返回:\n        dict: 包含各检验结果、Q-Q图状态及综合结论的字典\n    \"\"\"\n    # 转换为numpy数组并扁平化\n    data = np.asarray(ts_data).flatten()\n    \n    # 检查缺失值\n    if np.isnan(data).any():\n        raise ValueError(\"输入数据包含缺失值，请先处理缺失数据。\")\n    \n    n = len(data)\n    results = {}\n    \n    # Shapiro-Wilk检验（适用于小样本，n≤5000）\n    if n <= 5000:\n        shapiro_stat, shapiro_p = stats.shapiro(data)\n        results[\"shapiro_wilk\"] = {\n            \"statistic\": round(shapiro_stat, 4),\n            \"p_value\": round(shapiro_p, 4),\n            \"conclusion\": \"数据服从正态分布\" if shapiro_p > significance_level else \"数据不服从正态分布\"\n        }\n    else:\n        results[\"shapiro_wilk\"] = \"样本量超过5000，Shapiro-Wilk检验结果可靠性下降，已跳过该检验\"\n    \n    # Kolmogorov-Smirnov检验（使用样本均值和标准差作为参数估计）\n    ks_stat, ks_p = stats.kstest(data, 'norm', args=(np.mean(data), np.std(data, ddof=1)))\n    results[\"kolmogorov_smirnov\"] = {\n        \"statistic\": round(ks_stat, 4),\n        \"p_value\": round(ks_p, 4),\n        \"conclusion\": \"数据服从正态分布\" if ks_p > significance_level else \"数据不服从正态分布\"\n    }\n    \n    # Jarque-Bera检验\n    jb_stat, jb_p = stats.jarque_bera(data)\n    results[\"jarque_bera\"] = {\n        \"statistic\": round(jb_stat, 4),\n        \"p_value\": round(jb_p, 4),\n        \"conclusion\": \"数据服从正态分布\" if jb_p > significance_level else \"数据不服从正态分布\"\n    }\n    \n    # 生成Q-Q图\n    if plot_qq:\n        plt.figure(figsize=(8, 6))\n        stats.probplot(data, plot=plt)\n        plt.title(\"Q-Q 图：时间序列数据正态性检验\")\n        plt.savefig(\"qq_plot.png\")\n        plt.close()\n        results[\"qq_plot\"] = \"已生成Q-Q图，保存为qq_plot.png\"\n    \n    # 生成综合结论\n    reject_count = 0\n    valid_tests = 0\n    for test_name in [\"shapiro_wilk\", \"kolmogorov_smirnov\", \"jarque_bera\"]:\n        test_result = results[test_name]\n        if isinstance(test_result, dict):\n            valid_tests += 1\n            if test_result[\"conclusion\"] == \"数据不服从正态分布\":\n                reject_count += 1\n    \n    if valid_tests == 0:\n        overall = \"无法生成综合结论：无有效检验结果\"\n    else:\n        if reject_count > valid_tests / 2:\n            overall = \"综合检验结果，数据不服从正态分布\"\n        else:\n            overall = \"综合检验结果，数据服从正态分布\"\n    \n    results[\"overall_conclusion\"] = overall\n    results[\"significance_level\"] = significance_level\n    \n    return results",
    "requirements": [
        "pandas",
        "numpy",
        "scipy",
        "matplotlib"
    ],
    "examples_md_content": "## 示例1：服从正态分布的时间序列数据\n### 输入\n```python\nimport numpy as np\nimport pandas as pd\nfrom scripts.model import time_series_normality_test\n\n# 生成服从标准正态分布的时间序列数据\nnp.random.seed(42)\nts_data = pd.Series(np.random.normal(loc=0, scale=1, size=100))\nresult = time_series_normality_test(ts_data)\n```\n\n### 预期输出\n```json\n{\n    \"shapiro_wilk\": {\n        \"statistic\": 0.9897,\n        \"p_value\": 0.7284,\n        \"conclusion\": \"数据服从正态分布\"\n    },\n    \"kolmogorov_smirnov\": {\n        \"statistic\": 0.0694,\n        \"p_value\": 0.7453,\n        \"conclusion\": \"数据服从正态分布\"\n    },\n    \"jarque_bera\": {\n        \"statistic\": 0.5342,\n        \"p_value\": 0.7657,\n        \"conclusion\": \"数据服从正态分布\"\n    },\n    \"qq_plot\": \"已生成Q-Q图，保存为qq_plot.png\",\n    \"overall_conclusion\": \"综合检验结果，数据服从正态分布\",\n    \"significance_level\": 0.05\n}\n```\n\n## 示例2：不服从正态分布的时间序列数据\n### 输入\n```python\nimport numpy as np\nimport pandas as pd\nfrom scripts.model import time_series_normality_test\n\n# 生成服从指数分布的时间序列数据\nnp.random.seed(42)\nts_data = pd.Series(np.random.exponential(scale=1, size=100))\nresult = time_series_normality_test(ts_data)\n```\n\n### 预期输出\n```json\n{\n    \"shapiro_wilk\": {\n        \"statistic\": 0.8593,\n        \"p_value\": 0.0,\n        \"conclusion\": \"数据不服从正态分布\"\n    },\n    \"kolmogorov_smirnov\": {\n        \"statistic\": 0.2345,\n        \"p_value\": 0.0,\n        \"conclusion\": \"数据不服从正态分布\"\n    },\n    \"jarque_bera\": {\n        \"statistic\": 45.6789,\n        \"p_value\": 0.0,\n        \"conclusion\": \"数据不服从正态分布\"\n    },\n    \"qq_plot\": \"已生成Q-Q图，保存为qq_plot.png\",\n    \"overall_conclusion\": \"综合检验结果，数据不服从正态分布\",\n    \"significance_level\": 0.05\n}\n```\n\n## 示例3：大样本时间序列数据\n### 输入\n```python\nimport numpy as np\nimport pandas as pd\nfrom scripts.model import time_series_normality_test\n\n# 生成大样本正态分布数据\nnp.random.seed(42)\nts_data = pd.Series(np.random.normal(loc=5, scale=2, size=6000))\nresult = time_series_normality_test(ts_data, plot_qq=False)\n```\n\n### 预期输出\n```json\n{\n    \"shapiro_wilk\": \"样本量超过5000，Shapiro-Wilk检验结果可靠性下降，已跳过该检验\",\n    \"kolmogorov_smirnov\": {\n        \"statistic\": 0.0123,\n        \"p_value\": 0.9876,\n        \"conclusion\": \"数据服从正态分布\"\n    },\n    \"jarque_bera\": {\n        \"statistic\": 1.2345,\n        \"p_value\": 0.5397,\n        \"conclusion\": \"数据服从正态分布\"\n    },\n    \"overall_conclusion\": \"综合检验结果，数据服从正态分布\",\n    \"significance_level\": 0.05\n}\n```"
}