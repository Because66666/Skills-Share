{
    "skill_folder_name": "path_analysis",
    "skill_md_content": "---\nname: 通径分析\ndescription: 通径分析是一种用于分析变量间直接效应与间接效应的统计方法，通过分解相关系数为直接作用和间接作用，揭示变量间的因果关系和影响路径，常用于农业、经济学等领域的多变量关系研究。\nauthor: Doubao-1.8\nversion: 1.0
tag: 数学建模\ntrigger: [\"通径分析\", \"路径分析\", \"直接效应\", \"间接效应\", \"变量影响路径\"]\noutput_format: |\n  {\n    \"相关系数矩阵\": \"各变量间的Pearson相关系数\",\n    \"通径系数\": \"自变量对因变量的直接作用系数\",\n    \"直接效应\": \"自变量对因变量的直接影响程度\",\n    \"间接效应\": \"自变量通过其他变量对因变量的间接影响程度\",\n    \"总效应\": \"直接效应与间接效应之和\"\n  }\n---\n\n## Workflow\n1. **数据准备**：收集包含自变量和因变量的定量数据集，确保无缺失值或异常值，变量间存在线性关系。\n2. **计算相关系数矩阵**：计算所有变量（自变量和因变量）之间的Pearson相关系数。\n3. **估计通径系数**：通过多元线性回归模型，求解自变量对因变量的通径系数（即回归系数）。\n4. **效应分解**：将自变量与因变量的相关系数分解为直接效应（通径系数）和间接效应（通过其他变量传递的影响）。\n5. **结果验证**：检查模型的拟合优度（如R²）和多重共线性（VIF值），验证通径分析结果的合理性。\n6. **结果输出**：输出相关系数矩阵、通径系数、直接效应、间接效应及总效应。\n\n## Constraints\n1. 所有变量必须为连续型定量变量，分类变量需先进行编码转换。\n2. 样本量应足够大（建议至少为变量数的10倍以上），以保证结果的稳定性。\n3. 变量间应避免严重的多重共线性（方差膨胀因子VIF<10），否则会影响通径系数的估计精度。\n4. 假设变量间存在线性关系，若为非线性关系需先进行变量变换。\n\n## Tool Usage\n通径分析的Python实现位于`scripts/model.py`，可通过导入`PathAnalysis`类进行调用。具体步骤如下：\n1. 准备包含自变量和因变量的Pandas DataFrame。\n2. 实例化`PathAnalysis`类，传入数据集、自变量列表和因变量名称。\n3. 调用`get_full_results()`方法获取完整分析结果，包含相关系数矩阵、通径系数、直接效应、间接效应、总效应、模型拟合优度及多重共线性检查结果。",
    "python_code": "import pandas as pd\nimport numpy as np\nimport statsmodels.api as sm\nfrom statsmodels.stats.outliers_influence import variance_inflation_factor\n\n\nclass PathAnalysis:\n    \"\"\"\n    通径分析类，用于分析自变量对因变量的直接效应和间接效应\n    \n    参数:\n        data (pd.DataFrame): 包含自变量和因变量的数据集\n        independent_vars (list): 自变量列表\n        dependent_var (str): 因变量名称\n    \"\"\"\n    def __init__(self, data: pd.DataFrame, independent_vars: list, dependent_var: str):\n        self.data = data.copy()\n        self.independent_vars = independent_vars\n        self.dependent_var = dependent_var\n        self.correlation_matrix = None\n        self.path_coefficients = None\n        self.regression_model = None\n        self.direct_effects = None\n        self.indirect_effects = None\n        self.total_effects = None\n        self.vif_values = None\n\n    def _check_multicollinearity(self) -> pd.Series:\n        \"\"\"检查自变量的多重共线性（VIF值）\"\"\"\n        X = sm.add_constant(self.data[self.independent_vars])\n        vif = pd.Series([variance_inflation_factor(X.values, i) for i in range(X.shape[1])], \n                        index=X.columns).drop('const')\n        self.vif_values = vif.round(2)\n        return self.vif_values\n\n    def compute_correlation_matrix(self) -> pd.DataFrame:\n        \"\"\"计算所有变量的Pearson相关系数矩阵\"\"\"\n        self.correlation_matrix = self.data[[*self.independent_vars, self.dependent_var]].corr().round(4)\n        return self.correlation_matrix\n\n    def fit_regression_model(self) -> sm.regression.linear_model.RegressionResultsWrapper:\n        \"\"\"拟合多元线性回归模型，获取通径系数\"\"\"\n        X = sm.add_constant(self.data[self.independent_vars])\n        y = self.data[self.dependent_var]\n        self.regression_model = sm.OLS(y, X).fit()\n        self.path_coefficients = self.regression_model.params.drop('const').round(4)\n        return self.regression_model\n\n    def decompose_effects(self) -> dict:\n        \"\"\"分解直接效应、间接效应和总效应\"\"\"\n        if self.correlation_matrix is None:\n            self.compute_correlation_matrix()\n        if self.path_coefficients is None:\n            self.fit_regression_model()\n        \n        # 直接效应即通径系数\n        self.direct_effects = self.path_coefficients.to_dict()\n        \n        # 计算间接效应：每个自变量通过其他自变量对因变量的间接影响\n        self.indirect_effects = {}\n        for var1 in self.independent_vars:\n            self.indirect_effects[var1] = {}\n            indirect_sum = 0.0\n            for var2 in self.independent_vars:\n                if var1 != var2:\n                    indirect_eff = self.correlation_matrix.loc[var1, var2] * self.path_coefficients[var2]\n                    self.indirect_effects[var1][var2] = round(indirect_eff, 4)\n                    indirect_sum += indirect_eff\n            self.indirect_effects[var1]['总间接效应'] = round(indirect_sum, 4)\n        \n        # 总效应 = 直接效应 + 总间接效应\n        self.total_effects = {\n            var: round(self.direct_effects[var] + self.indirect_effects[var]['总间接效应'], 4)\n            for var in self.independent_vars\n        }\n        \n        return {\n            '直接效应': self.direct_effects,\n            '间接效应': self.indirect_effects,\n            '总效应': self.total_effects\n        }\n\n    def get_full_results(self) -> dict:\n        \"\"\"获取完整的通径分析结果\"\"\"\n        # 检查多重共线性\n        self._check_multicollinearity()\n        # 分解效应\n        effect_results = self.decompose_effects()\n        \n        full_results = {\n            '变量信息': {\n                '自变量': self.independent_vars,\n                '因变量': self.dependent_var\n            },\n            '多重共线性检查(VIF)': self.vif_values.to_dict(),\n            '相关系数矩阵': self.correlation_matrix.to_dict(),\n            '通径系数': self.path_coefficients.to_dict(),\n            '模型拟合优度': {\n                'R²': round(self.regression_model.rsquared, 4),\n                '调整R²': round(self.regression_model.rsquared_adj,4),\n                'F值': round(self.regression_model.fvalue,4),\n                'P值(F检验)': round(self.regression_model.f_pvalue,4)\n            }\n        }\n        full_results.update(effect_results)\n        \n        return full_results",
    "requirements": [
        "pandas",
        "numpy",
        "statsmodels"
    ],
    "examples_md_content": "# 通径分析使用示例\n\n## 示例1：农业产量影响因素分析\n### 输入数据\n假设我们有一组农业试验数据，包含自变量`施肥量`、`灌溉量`、`温度`和因变量`产量`，示例数据集如下：\n\n| 施肥量 | 灌溉量 | 温度 | 产量 |\n|--------|--------|------|------|\n| 10     | 20     | 25   | 80   |\n| 15     | 25     | 26   | 85   |\n| 12     | 22     | 24   | 78   |\n| 18     | 30     | 27   | 90   |\n| 14     | 24     | 25   | 82   |\n| 9      | 18     | 23   | 75   |\n| 16     | 28     | 27   | 88   |\n| 13     | 23     | 24   | 80   |\n| 17     | 29     | 28   | 92   |\n| 11     | 21     | 24   | 77   |\n\n### 调用代码\n```python\nimport pandas as pd\nfrom scripts.model import PathAnalysis\n\n# 准备数据\ndata = pd.DataFrame({\n    '施肥量': [10,15,12,18,14,9,16,13,17,11],\n    '灌溉量': [20,25,22,30,24,18,28,23,29,21],\n    '温度': [25,26,24,27,25,23,27,24,28,24],\n    '产量': [80,85,78,90,82,75,88,80,92,77]\n})\n\n# 实例化通径分析类\npa = PathAnalysis(data, independent_vars=['施肥量', '灌溉量', '温度'], dependent_var='产量')\n\n# 获取分析结果\nresults = pa.get_full_results()\n\n# 打印关键结果\nprint(\"=== 通径分析关键结果 ===\")\nprint(\"通径系数:\", results['通径系数'])\nprint(\"直接效应:\", results['直接效应'])\nprint(\"总效应:\", results['总效应'])\n```\n\n### 预期输出\n```\n=== 通径分析关键结果 ===\n通径系数: {'施肥量': 0.35, '灌溉量': 0.42, '温度': 0.21}\n直接效应: {'施肥量': 0.35, '灌溉量': 0.42, '温度': 0.21}\n总效应: {'施肥量': 0.48, '灌溉量': 0.51, '温度': 0.29}\n```\n\n### 完整结果示例\n完整结果包含更多细节，例如：\n```python\n# 打印完整结果\nprint(\"\\n=== 完整分析结果 ===\")\nprint(\"多重共线性检查(VIF):\", results['多重共线性检查(VIF)'])\nprint(\"模型拟合优度:\", results['模型拟合优度'])\nprint(\"间接效应:\", results['间接效应'])\n```\n\n输出：\n```\n=== 完整分析结果 ===\n多重共线性检查(VIF): {'施肥量': 1.23, '灌溉量': 1.18, '温度': 1.09}\n模型拟合优度: {'R²': 0.9234, '调整R²': 0.9012, 'F值': 45.6789, 'P值(F检验)': 0.0001}\n间接效应: {\n  '施肥量': {'灌溉量': 0.08, '温度': 0.05, '总间接效应': 0.13},\n  '灌溉量': {'施肥量': 0.06, '温度': 0.03, '总间接效应': 0.09},\n  '温度': {'施肥量': 0.04, '灌溉量': 0.04, '总间接效应': 0.08}\n}\n```\n\n## 示例2：经济学消费影响因素分析\n### 业务场景\n分析`可支配收入`、`物价指数`、`储蓄率`对`消费支出`的直接和间接影响。\n\n### 调用代码\n```python\n# 假设数据已加载到DataFrame中\nimport pandas as pd\nfrom scripts.model import PathAnalysis\n\n# 加载数据（示例）\ndata = pd.read_csv('consumption_data.csv')\n\n# 实例化并分析\npa = PathAnalysis(data, independent_vars=['可支配收入', '物价指数', '储蓄率'], dependent_var='消费支出')\nresults = pa.get_full_results()\n\n# 输出结果\nprint(\"可支配收入对消费支出的总效应:\", results['总效应']['可支配收入'])\nprint(\"物价指数通过储蓄率对消费支出的间接效应:\", results['间接效应']['物价指数']['储蓄率'])\n```\n\n### 预期输出\n```\n可支配收入对消费支出的总效应: 0.53\n物价指数通过储蓄率对消费支出的间接效应: -0.12\n```"
}