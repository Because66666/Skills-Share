{
    "skill_folder_name": "markov_chain_sequence_prediction",
    "skill_md_content": "---\nname: 随机序列的Markov链预测\ndescription: 基于马尔可夫链模型对具有马尔可夫性的离散随机序列进行状态预测，通过构建状态转移概率矩阵，利用当前状态预测下一时刻的可能状态及概率分布。\nauthor: Doubao-1.8\nversion: 1.0
tag: 数学建模\ntrigger: 当需要对离散状态随机序列进行短期预测，且序列满足马尔可夫性（未来状态仅依赖当前状态）时触发\noutput_format: JSON格式，包含预测的下一状态、各状态的预测概率、状态转移概率矩阵及状态空间列表\n---\n\n## 工作流程\n1. **数据预处理**：将原始随机序列转换为有限离散的状态序列，确保状态定义清晰且无歧义。\n2. **构建状态转移概率矩阵**：统计历史序列中所有状态间的转移频率，并归一化得到转移概率。\n3. **确定初始状态**：获取当前时刻的状态作为预测的起始状态。\n4. **执行预测计算**：利用转移概率矩阵计算当前状态下各可能下一状态的概率，选择概率最高的状态作为预测结果。\n5. **结果输出**：返回预测状态、概率分布及转移矩阵等信息。\n\n## 约束条件\n- 序列必须满足马尔可夫性，即未来状态的概率分布仅依赖于当前状态，与过去的历史状态无关。\n- 状态空间必须是有限且离散的，不支持连续值或无限状态的序列。\n- 历史数据量需足够大，以保证状态转移概率矩阵的统计可靠性，避免因数据不足导致的概率偏差。\n- 仅适用于短期状态预测，长期预测的误差会随预测步数增加而显著增大。\n\n## 工具使用\n马尔可夫链预测的核心实现代码位于`scripts/model.py`，可通过导入该模块中的`MarkovChainPredictor`类来使用。该类封装了状态转移矩阵构建、状态预测等功能，支持输入离散状态序列完成模型训练，并基于当前状态输出预测结果。",
    "python_code": "import numpy as np\nimport pandas as pd\n\nclass MarkovChainPredictor:\n    \"\"\"\n    马尔可夫链序列预测器，用于对离散状态随机序列进行下一状态预测\n    \"\"\"\n    def __init__(self):\n        self.states = None  # 所有可能的离散状态列表\n        self.state_index = {}  # 状态到索引的映射字典\n        self.transition_matrix = None  # 状态转移概率矩阵\n\n    def fit(self, sequence):\n        \"\"\"\n        根据历史序列训练模型，构建状态转移概率矩阵\n        \n        参数:\n            sequence: list，离散状态组成的历史序列\n        \"\"\"\n        if not isinstance(sequence, list) or len(sequence) < 2:\n            raise ValueError(\"输入序列必须是长度至少为2的列表\")\n        \n        # 获取所有唯一状态并排序\n        self.states = sorted(list(set(sequence)))\n        self.state_index = {state: idx for idx, state in enumerate(self.states)}\n        num_states = len(self.states)\n        \n        # 初始化转移矩阵\n        self.transition_matrix = np.zeros((num_states, num_states), dtype=np.float64)\n        \n        # 统计状态转移次数\n        for i in range(len(sequence) - 1):\n            current_state = sequence[i]\n            next_state = sequence[i + 1]\n            current_idx = self.state_index[current_state]\n            next_idx = self.state_index[next_state]\n            self.transition_matrix[current_idx][next_idx] += 1\n        \n        # 归一化得到转移概率（处理零行避免除以零）\n        row_sums = self.transition_matrix.sum(axis=1, keepdims=True)\n        self.transition_matrix = np.divide(self.transition_matrix, row_sums, where=row_sums != 0)\n\n    def predict_next_state(self, current_state):\n        \"\"\"\n        根据当前状态预测下一时刻的状态及概率分布\n        \n        参数:\n            current_state: 当前状态，必须在训练的状态空间中\n        \n        返回:\n            dict，包含预测状态、概率分布、转移矩阵和状态空间\n        \"\"\"\n        if self.transition_matrix is None:\n            raise ValueError(\"模型尚未训练，请先调用fit方法输入历史序列\")\n        \n        if current_state not in self.state_index:\n            raise ValueError(f\"当前状态{current_state}不在训练的状态空间中\")\n        \n        current_idx = self.state_index[current_state]\n        prob_dist = self.transition_matrix[current_idx]\n        \n        # 找到概率最高的状态\n        max_prob_idx = np.argmax(prob_dist)\n        predicted_state = self.states[max_prob_idx]\n        \n        # 构建概率分布字典\n        prob_dict = {state: float(prob_dist[self.state_index[state]]) for state in self.states}\n        \n        return {\n            \"predicted_next_state\": predicted_state,\n            \"state_probabilities\": prob_dict,\n            \"transition_matrix\": self.transition_matrix.tolist(),\n            \"states\": self.states\n        }\n",
    "requirements": [
        "numpy",
        "pandas"
    ],
    "examples_md_content": "# 使用示例\n\n## 示例1：天气状态预测\n### 输入代码\n```python\nfrom scripts.model import MarkovChainPredictor\n\n# 历史天气状态序列（晴/阴/雨）\nweather_sequence = ['晴', '晴', '阴', '雨', '阴', '晴', '晴', '阴', '阴', '雨']\ncurrent_weather = '阴'\n\n# 初始化并训练模型\npredictor = MarkovChainPredictor()\npredictor.fit(weather_sequence)\nresult = predictor.predict_next_state(current_weather)\n```\n\n### 预期输出\n```json\n{\n    \"predicted_next_state\": \"雨\",\n    \"state_probabilities\": {\n        \"晴\": 0.25,\n        \"阴\": 0.25,\n        \"雨\": 0.5\n    },\n    \"transition_matrix\": [\n        [0.5, 0.5, 0.0],\n        [0.25, 0.25, 0.5],\n        [0.0, 1.0, 0.0]\n    ],\n    \"states\": [\"晴\", \"阴\", \"雨\"]\n}\n```\n\n## 示例2：股票走势预测\n### 输入代码\n```python\nfrom scripts.model import MarkovChainPredictor\n\n# 历史股票走势序列（涨/平/跌）\nstock_sequence = ['涨', '涨', '平', '跌', '涨', '平', '平', '跌', '涨', '涨']\ncurrent_trend = '涨'\n\n# 初始化并训练模型\npredictor = MarkovChainPredictor()\npredictor.fit(stock_sequence)\nresult = predictor.predict_next_state(current_trend)\n```\n\n### 预期输出\n```json\n{\n    \"predicted_next_state\": \"涨\",\n    \"state_probabilities\": {\n        \"涨\": 0.5,\n        \"平\": 0.5,\n        \"跌\": 0.0\n    },\n    \"transition_matrix\": [\n        [0.5, 0.5, 0.0],\n        [0.0, 0.3333333333333333, 0.6666666666666666],\n        [1.0, 0.0, 0.0]\n    ],\n    \"states\": [\"涨\", \"平\", \"跌\"]\n}\n```"
}