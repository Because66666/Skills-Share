{
    "skill_folder_name": "time_series_stationarity_testing",
    "skill_md_content": "---\nname: 时间序列数据平稳性检验\ndescription: 该技能用于检验时间序列数据的平稳性，通过ADF单位根检验和KPSS趋势平稳性检验两种方法，判断序列是否满足平稳性假设，为后续时间序列建模（如ARIMA、SARIMA等）提供依据。\nauthor: Doubao-1.8\nversion: 1.0\ntrigger: 当需要判断时间序列是否平稳时触发，例如在构建时间序列预测模型前、分析序列的统计特性时。\noutput_format: |\n  返回一个包含以下内容的字典：\n  1. 显著性水平（significance_level）\n  2. ADF检验结果（adf_test）：统计量、p值、临界值、是否平稳、结论\n  3. KPSS检验结果（kpss_test）：统计量、p值、临界值、是否平稳、结论\n  4. 综合结论（overall_conclusion）\n---\n\n## 工作流程\n1. **数据准备**：确保输入为单变量时间序列数据（pandas Series类型），无缺失值，样本量建议不少于20个数据点。\n2. **选择检验方法**：默认同时使用ADF检验（检测单位根）和KPSS检验（检测趋势平稳性），两种方法互补以提高结论可靠性。\n3. **执行检验**：调用工具中的实现函数，传入时间序列数据和显著性水平（默认0.05）。\n4. **结果分析**：根据两种检验的p值与显著性水平的比较，判断序列是否平稳。\n5. **输出结论**：返回各检验的详细结果及综合平稳性结论。\n\n## 约束条件\n1. 输入必须是有效的单变量时间序列，且无缺失值；若存在缺失值，需先进行填充或删除处理。\n2. 样本量需足够大（至少20个数据点），否则检验结果可能存在偏差。\n3. ADF检验和KPSS检验的原假设不同，可能出现结论不一致的情况，此时需要结合序列的实际趋势和波动进一步分析。\n4. 显著性水平默认采用0.05，可根据需求调整，但需明确说明。\n\n## 工具使用\n该技能的实现代码位于`scripts/model.py`中，可通过调用其中的`test_stationarity`函数执行平稳性检验。函数接受pandas Series类型的时间序列数据和可选的显著性水平参数，返回结构化的检验结果字典。具体调用方式可参考`examples.md`中的示例。",
    "python_code": "import pandas as pd\nimport warnings\nfrom statsmodels.tsa.stattools import adfuller, kpss\n\n\ndef test_stationarity(ts: pd.Series, significance_level: float = 0.05) -> dict:\n    \"\"\"\n    对时间序列进行平稳性检验，结合ADF单位根检验和KPSS趋势平稳性检验\n    \n    参数:\n        ts: 输入的单变量时间序列，需为pandas Series类型，建议带有时间戳索引\n        significance_level: 显著性水平，用于判断检验结果的显著性，默认0.05\n    \n    返回:\n        dict: 包含两种检验的详细结果及综合结论的字典\n    \"\"\"\n    # 数据有效性验证\n    if not isinstance(ts, pd.Series):\n        raise TypeError(\"输入数据必须是pandas Series类型的单变量时间序列\")\n    if ts.isnull().any():\n        raise ValueError(\"时间序列中存在缺失值，请先处理缺失数据后再进行检验\")\n    if len(ts) < 20:\n        warnings.warn(\"样本量过小（少于20个数据点），检验结果可能不可靠\")\n    \n    # ADF检验：原假设为序列存在单位根（非平稳）\n    adf_stat, adf_pval, _, _, adf_crit, _ = adfuller(ts)\n    adf_is_stationary = adf_pval < significance_level\n    adf_conclusion = f\"ADF检验：{'序列平稳' if adf_is_stationary else '序列非平稳'}（p值={adf_pval:.4f}，显著性水平={significance_level}）\"\n    \n    # KPSS检验：原假设为序列是趋势平稳的\n    kpss_stat, kpss_pval, _, kpss_crit = kpss(ts, regression='c')\n    kpss_is_stationary = False\n    if kpss_pval is not None:\n        kpss_is_stationary = kpss_pval >= significance_level\n        kpss_conclusion = f\"KPSS检验：{'序列平稳（趋势平稳）' if kpss_is_stationary else '序列非平稳'}（p值={kpss_pval:.4f}，显著性水平={significance_level}）\"\n    else:\n        # 当p值无法直接计算时，对比统计量与临界值\n        crit_value = kpss_crit.get(f\"{significance_level:.2f}\", kpss_crit.get(list(kpss_crit.keys())[-1]))\n        kpss_is_stationary = kpss_stat < crit_value\n        kpss_conclusion = f\"KPSS检验：{'序列平稳（趋势平稳）' if kpss_is_stationary else '序列非平稳'}（统计量={kpss_stat:.4f}，{significance_level:.2f}水平临界值={crit_value:.4f}）\"\n    \n    # 生成综合结论\n    if adf_is_stationary and kpss_is_stationary:\n        overall_conclusion = \"综合结论：序列是严格平稳的，满足时间序列建模的平稳性要求\"\n    elif adf_is_stationary and not kpss_is_stationary:\n        overall_conclusion = \"综合结论：序列无单位根但存在趋势成分，建议考虑去趋势处理\"\n    elif not adf_is_stationary and kpss_is_stationary:\n        overall_conclusion = \"综合结论：序列存在单位根但趋势平稳，建议进行差分处理以消除单位根\"\n    else:\n        overall_conclusion = \"综合结论：序列非平稳，建议进行差分或其他变换（如对数变换）后重新检验\"\n    \n    return {\n        \"significance_level\": significance_level,\n        \"adf_test\": {\n            \"statistic\": adf_stat,\n            \"pvalue\": adf_pval,\n            \"critical_values\": adf_crit,\n            \"is_stationary\": adf_is_stationary,\n            \"conclusion\": adf_conclusion\n        },\n        \"kpss_test\": {\n            \"statistic\": kpss_stat,\n            \"pvalue\": kpss_pval,\n            \"critical_values\": kpss_crit,\n            \"is_stationary\": kpss_is_stationary,\n            \"conclusion\": kpss_conclusion\n        },\n        \"overall_conclusion\": overall_conclusion\n    }",
    "requirements": [
        "pandas",
        "statsmodels",
        "numpy"
    ],
    "examples_md_content": "# 时间序列平稳性检验使用示例\n\n## 示例1：平稳时间序列（白噪声）\n### 输入代码\n```python\nimport pandas as pd\nimport numpy as np\nfrom scripts.model import test_stationarity\n\n# 生成白噪声时间序列\nnp.random.seed(42)\ndates = pd.date_range(start=\"2023-01-01\", periods=100)\nwhite_noise = pd.Series(np.random.normal(0, 1, 100), index=dates)\n\n# 调用平稳性检验函数\nresult = test_stationarity(white_noise)\n```\n\n### 预期输出\n```python\n{\n    'significance_level': 0.05,\n    'adf_test': {\n        'statistic': -7.428257126021784,\n        'pvalue': 5.865313242738345e-11,\n        'critical_values': {'1%': -3.498198082189098, '5%': -2.891208211860468, '10%': -2.5825959973472097},\n        'is_stationary': True,\n        'conclusion': 'ADF检验：序列平稳（p值=0.0000，显著性水平=0.05）'\n    },\n    'kpss_test': {\n        'statistic': 0.3575631127687258,\n        'pvalue': 0.1,\n        'critical_values': {'10%': 0.347, '5%': 0.463, '2.5%': 0.574, '1%': 0.739},\n        'is_stationary': True,\n        'conclusion': 'KPSS检验：序列平稳（趋势平稳）（p值=0.1000，显著性水平=0.05）'\n    },\n    'overall_conclusion': '综合结论：序列是严格平稳的，满足时间序列建模的平稳性要求'\n}\n```\n\n## 示例2：非平稳时间序列（随机游走）\n### 输入代码\n```python\nimport pandas as pd\nimport numpy as np\nfrom scripts.model import test_stationarity\n\n# 生成随机游走时间序列\nnp.random.seed(42)\ndates = pd.date_range(start=\"2023-01-01\", periods=100)\nrandom_walk = pd.Series(np.cumsum(np.random.normal(0, 1, 100)), index=dates)\n\n# 调用平稳性检验函数\nresult = test_stationarity(random_walk)\n```\n\n### 预期输出\n```python\n{\n    'significance_level': 0.05,\n    'adf_test': {\n        'statistic': -1.216757331336313,\n        'pvalue': 0.663269157118887,\n        'critical_values': {'1%': -3.498198082189098, '5%': -2.891208211860468, '10%': -2.5825959973472097},\n        'is_stationary': False,\n        'conclusion': 'ADF检验：序列非平稳（p值=0.6633，显著性水平=0.05）'\n    },\n    'kpss_test': {\n        'statistic': 1.893405435218422,\n        'pvalue': 0.01,\n        'critical_values': {'10%': 0.347, '5%': 0.463, '2.5%': 0.574, '1%': 0.739},\n        'is_stationary': False,\n        'conclusion': 'KPSS检验：序列非平稳（p值=0.0100，显著性水平=0.05）'\n    },\n    'overall_conclusion': '综合结论：序列非平稳，建议进行差分或其他变换（如对数变换）后重新检验'\n}\n```"
}