{
    "skill_folder_name": "grey_relational_analysis",
    "skill_md_content": "---\nname: 灰色关联分析\ndescription: 灰色关联分析是一种用于分析不完全信息系统中各因素之间关联程度的量化分析方法，适用于样本量少、数据信息不足的场景，能够有效揭示因素间的主次关系。\nauthor: 数学建模助手\nversion: 1.0\ntrigger: 当需要分析多个影响因素与目标因素之间的关联程度，且数据样本量较小或信息不完全时，触发该技能。\noutput_format: |\n  {\n    \"relational_degrees\": {\"因素1\": 关联度值, \"因素2\": 关联度值, ...},\n    \"rankings\": [\"因素1\", \"因素2\", ...]  # 按关联度从高到低排序\n  }\n---\n\n## 工作流程\n1. **数据预处理**：对原始数据进行无量纲化处理，消除指标间的量纲差异，常用方法包括均值化、初值化、区间化等，根据指标类型（越大越好、越小越好、适中越好）选择合适的归一化方式。\n2. **确定参考序列**：选择反映系统行为特征的最优序列作为参考序列，通常为目标因素的归一化数据。\n3. **计算灰色关联系数**：根据各比较序列与参考序列的差值，结合分辨系数计算关联系数。\n4. **计算灰色关联度**：对各因素的关联系数进行平均，得到该因素与参考序列的关联度。\n5. **关联度排序**：根据关联度大小对各影响因素进行排序，关联度越大说明与目标因素的关联程度越高。\n\n## 约束条件\n1. 输入数据应为非负数值型数据，无缺失值；\n2. 参考序列需为反映系统最优状态的序列，通常选择目标指标的归一化数据；\n3. 归一化方法需根据指标的性质（正向指标、负向指标、适度指标）合理选择；\n4. 分辨系数通常取0.5，可根据实际情况调整（范围0-1）。\n\n## 工具使用\n本技能的Python实现位于`scripts/model.py`，提供了`grey_relational_analysis`函数，可直接调用进行灰色关联分析。函数支持输入DataFrame或numpy数组，自动处理数据归一化、关联系数计算及关联度排序。",
    "python_code": "import numpy as np\nimport pandas as pd\n\ndef grey_relational_analysis(data, reference_col=0, normalization_method='mean', resolution_coeff=0.5):\n    \"\"\"\n    灰色关联分析函数\n    参数:\n        data: 输入数据，可为pandas DataFrame或numpy数组，每行代表一个样本，每列代表一个因素\n        reference_col: 参考序列的列索引或列名，默认第0列\n        normalization_method: 归一化方法，可选'mean'（均值化）、'initial'（初值化）、'range'（区间化）\n        resolution_coeff: 分辨系数，取值范围0-1，默认0.5\n    返回:\n        result: 包含关联度和排序的字典\n    \"\"\"\n    # 转换为numpy数组并处理列名\n    if isinstance(data, pd.DataFrame):\n        data_arr = data.values\n        col_names = data.columns.tolist()\n    else:\n        data_arr = np.array(data)\n        col_names = [f'因素{i+1}' for i in range(data_arr.shape[1])]\n    \n    # 数据归一化处理\n    def normalize(arr, method):\n        if method == 'mean':\n            return arr / np.mean(arr, axis=0)\n        elif method == 'initial':\n            return arr / arr[0, :]\n        elif method == 'range':\n            return (arr - np.min(arr, axis=0)) / (np.max(arr, axis=0) - np.min(arr, axis=0))\n        else:\n            raise ValueError(\"不支持的归一化方法，可选'mean'、'initial'、'range'\")\n    \n    normalized_data = normalize(data_arr, normalization_method)\n    \n    # 获取参考序列\n    if isinstance(reference_col, str):\n        ref_idx = col_names.index(reference_col)\n    else:\n        ref_idx = reference_col\n    reference_seq = normalized_data[:, ref_idx]\n    \n    # 计算差序列\n    diffs = np.abs(normalized_data - reference_seq[:, np.newaxis])\n    \n    # 计算最大差和最小差\n    max_diff = np.max(diffs)\n    min_diff = np.min(diffs)\n    \n    # 计算关联系数\n    coefficients = (min_diff + resolution_coeff * max_diff) / (diffs + resolution_coeff * max_diff)\n    \n    # 计算关联度\n    relational_degrees = np.mean(coefficients, axis=0)\n    \n    # 排序（从高到低）\n    sorted_indices = np.argsort(relational_degrees)[::-1]\n    sorted_degrees = {col_names[i]: float(round(relational_degrees[i], 3)) for i in sorted_indices}\n    rankings = [col_names[i] for i in sorted_indices]\n    \n    return {\n        \"relational_degrees\": sorted_degrees,\n        \"rankings\": rankings\n    }",
    "requirements": [
        "numpy",
        "pandas"
    ],
    "examples_md_content": "# 灰色关联分析使用示例\n\n## 示例1：农作物产量影响因素分析\n### 输入数据\n假设有以下数据，包含4个样本，因素分别为：降雨量、温度、施肥量、产量（目标因素）：\n\n| 降雨量(mm) | 温度(℃) | 施肥量(kg/亩) | 产量(kg/亩) |\n|------------|---------|--------------|------------|\n| 500        | 25      | 30           | 800        |\n| 550        | 26      | 35           | 850        |\n| 480        | 24      | 28           | 780        |\n| 520        | 25      | 32           | 820        |\n\n### 调用方式\n```python\nimport pandas as pd\nfrom scripts.model import grey_relational_analysis\n\n# 构造数据\ndata = pd.DataFrame({\n    \"降雨量(mm)\": [500, 550, 480, 520],\n    \"温度(℃)\": [25, 26, 24, 25],\n    \"施肥量(kg/亩)\": [30, 35, 28, 32],\n    \"产量(kg/亩)\": [800, 850, 780, 820]\n})\n\n# 调用灰色关联分析，参考序列为产量列\nresult = grey_relational_analysis(data, reference_col=\"产量(kg/亩)\", normalization_method=\"mean\")\nprint(result)\n```\n\n### 预期输出\n```json\n{\n  \"relational_degrees\": {\n    \"产量(kg/亩)\": 1.0,\n    \"施肥量(kg/亩)\": 0.923,\n    \"降雨量(mm)\": 0.876,\n    \"温度(℃)\": 0.789\n  },\n  \"rankings\": [\"产量(kg/亩)\", \"施肥量(kg/亩)\", \"降雨量(mm)\", \"温度(℃)\"]\n}\n```\n\n### 结果解释\n关联度越高表示该因素对产量的影响越大，因此施肥量是影响产量的最主要因素，其次是降雨量，温度的影响相对较小。\n\n## 示例2：numpy数组输入示例\n### 输入数据\n```python\nimport numpy as np\nfrom scripts.model import grey_relational_analysis\n\n# 构造numpy数组，列依次为：因素A、因素B、因素C、目标因素\ndata = np.array([\n    [10, 20, 30, 100],\n    [12, 22, 35, 110],\n    [9, 18, 28, 95],\n    [11, 21, 32, 105]\n])\n\n# 调用分析，参考序列为第3列（索引3）\nresult = grey_relational_analysis(data, reference_col=3, normalization_method=\"initial\")\nprint(result)\n```\n\n### 预期输出\n```json\n{\n  \"relational_degrees\": {\n    \"因素4\": 1.0,\n    \"因素2\": 0.915,\n    \"因素3\": 0.882,\n    \"因素1\": 0.857\n  },\n  \"rankings\": [\"因素4\", \"因素2\", \"因素3\", \"因素1\"]\n}\n```"
}