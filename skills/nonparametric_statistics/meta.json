{
    "skill_folder_name": "nonparametric_statistics",
    "skill_md_content": "---\nname: 非参数统计分析工具\ndescription: 提供多种常用非参数统计检验方法的实现，适用于不满足正态分布假设的数据集，包括Mann-Whitney U检验、Wilcoxon符号秩检验、Kruskal-Wallis H检验等，帮助用户进行稳健的统计推断。\nauthor: Doubao-1.8\nversion: 1.0.0\ntrigger: 当用户需要对不满足正态分布的数据集进行统计检验，或提及非参数统计、Mann-Whitney、Wilcoxon、Kruskal-Wallis等关键词时触发。\noutput_format: JSON格式，包含检验类型、统计量、p值、备择假设及专业结论。\n---\n\n## Workflow\n1. **需求确认**：明确用户需要进行的非参数检验类型（两独立样本、配对样本、多独立样本等）。\n2. **数据准备**：收集并整理符合检验要求的数值型数据集，提前处理缺失值和异常值。\n3. **工具调用**：根据检验类型调用`scripts/model.py`中的对应函数，传入预处理后的数据集。\n4. **结果解析**：根据输出的统计量和p值，结合显著性水平判断是否拒绝原假设，生成专业统计结论。\n\n## Constraints\n- 数据需符合对应非参数检验的前提条件：\n  - Mann-Whitney U检验：两组样本相互独立，样本来自连续分布或有序分类分布。\n  - Wilcoxon符号秩检验：配对样本差值的分布对称，无方向偏倚。\n  - Kruskal-Wallis H检验：多组样本相互独立，各组样本来自相同类型的分布。\n- 样本量需满足检验的基本要求：如Wilcoxon符号秩检验通常要求样本量n≥5，Kruskal-Wallis H检验要求每组样本量≥3。\n- 输入数据应为数值型（整数或浮点数），避免包含非数值型数据和缺失值。\n\n## Tool Usage\n本工具的Python实现位于`scripts/model.py`，包含三个核心函数：\n- `mann_whitney_u_test`：执行Mann-Whitney U检验，用于比较两独立样本的中位数差异。\n- `wilcoxon_signed_rank_test`：执行Wilcoxon符号秩检验，用于比较配对样本的中位数差异。\n- `kruskal_wallis_h_test`：执行Kruskal-Wallis H检验，用于比较多独立样本的中位数差异。\n用户可根据具体需求调用对应函数，传入符合要求的数据集参数即可获取检验结果。",
    "python_code": "import numpy as np\nfrom scipy import stats\n\ndef mann_whitney_u_test(sample1, sample2, alternative='two-sided'):\n    \"\"\"\n    Mann-Whitney U检验：用于比较两个独立样本的中位数是否存在显著差异\n    参数:\n        sample1: 第一组样本数据（列表或数组）\n        sample2: 第二组样本数据（列表或数组）\n        alternative: 备择假设类型，可选'less', 'greater', 'two-sided'，默认'two-sided'\n    返回:\n        dict: 包含检验结果的字典\n    \"\"\"\n    sample1 = np.array(sample1)\n    sample2 = np.array(sample2)\n    \n    # 数据类型检查\n    if not np.issubdtype(sample1.dtype, np.number) or not np.issubdtype(sample2.dtype, np.number):\n        raise ValueError(\"输入数据必须为数值型\")\n    \n    # 执行检验\n    u_stat, p_val = stats.mannwhitneyu(sample1, sample2, alternative=alternative)\n    \n    # 生成结论\n    alpha = 0.05\n    if p_val < alpha:\n        conclusion = f\"在显著性水平{alpha}下，拒绝原假设，认为两组样本的中位数存在显著差异\"\n    else:\n        conclusion = f\"在显著性水平{alpha}下，不拒绝原假设，认为两组样本的中位数无显著差异\"\n    \n    return {\n        'test_type': 'Mann-Whitney U检验',\n        'statistic': float(u_stat),\n        'p_value': float(p_val),\n        'alternative_hypothesis': alternative,\n        'conclusion': conclusion\n    }\n\ndef wilcoxon_signed_rank_test(sample1, sample2=None, alternative='two-sided'):\n    \"\"\"\n    Wilcoxon符号秩检验：用于比较配对样本的中位数是否存在显著差异\n    参数:\n        sample1: 第一组样本数据或配对样本的差值（列表或数组）\n        sample2: 第二组样本数据（若传入则计算与sample1的差值），可选\n        alternative: 备择假设类型，可选'less', 'greater', 'two-sided'，默认'two-sided'\n    返回:\n        dict: 包含检验结果的字典\n    \"\"\"\n    if sample2 is not None:\n        sample1 = np.array(sample1)\n        sample2 = np.array(sample2)\n        diff = sample1 - sample2\n    else:\n        diff = np.array(sample1)\n    \n    # 数据类型检查\n    if not np.issubdtype(diff.dtype, np.number):\n        raise ValueError(\"输入数据必须为数值型\")\n    \n    # 移除差值为0的样本\n    diff = diff[diff != 0]\n    if len(diff) == 0:\n        raise ValueError(\"所有配对样本的差值均为0，无法进行检验\")\n    \n    # 执行检验\n    w_stat, p_val = stats.wilcoxon(diff, alternative=alternative)\n    \n    # 生成结论\n    alpha = 0.05\n    if p_val < alpha:\n        conclusion = f\"在显著性水平{alpha}下，拒绝原假设，认为配对样本的中位数存在显著差异\"\n    else:\n        conclusion = f\"在显著性水平{alpha}下，不拒绝原假设，认为配对样本的中位数无显著差异\"\n    \n    return {\n        'test_type': 'Wilcoxon符号秩检验',\n        'statistic': float(w_stat),\n        'p_value': float(p_val),\n        'alternative_hypothesis': alternative,\n        'conclusion': conclusion\n    }\n\ndef kruskal_wallis_h_test(*samples, alternative='two-sided'):\n    \"\"\"\n    Kruskal-Wallis H检验：用于比较多个独立样本的中位数是否存在显著差异\n    参数:\n        *samples: 多个独立样本数据（每个为列表或数组）\n        alternative: 备择假设类型，当前仅支持'two-sided'，默认'two-sided'\n    返回:\n        dict: 包含检验结果的字典\n    \"\"\"\n    # 转换为数组并检查数据类型\n    sample_arrays = [np.array(sample) for sample in samples]\n    for idx, sample in enumerate(sample_arrays):\n        if not np.issubdtype(sample.dtype, np.number):\n            raise ValueError(f\"第{idx+1}组样本数据必须为数值型\")\n    \n    # 执行检验\n    h_stat, p_val = stats.kruskal(*sample_arrays, alternative=alternative)\n    \n    # 生成结论\n    alpha = 0.05\n    if p_val < alpha:\n        conclusion = f\"在显著性水平{alpha}下，拒绝原假设，认为至少有一组样本的中位数与其他组存在显著差异\"\n    else:\n        conclusion = f\"在显著性水平{alpha}下，不拒绝原假设，认为所有组样本的中位数无显著差异\"\n    \n    return {\n        'test_type': 'Kruskal-Wallis H检验',\n        'statistic': float(h_stat),\n        'p_value': float(p_val),\n        'alternative_hypothesis': alternative,\n        'conclusion': conclusion\n    }",
    "requirements": [
        "numpy",
        "scipy"
    ],
    "examples_md_content": "# 非参数统计工具使用示例\n\n## 示例1：Mann-Whitney U检验（两独立样本）\n### 输入\n```python\nsample1 = [12, 15, 18, 20, 22]\nsample2 = [10, 13, 16, 19, 21]\nresult = mann_whitney_u_test(sample1, sample2)\n```\n### 预期输出\n```json\n{\n    \"test_type\": \"Mann-Whitney U检验\",\n    \"statistic\": 10.0,\n    \"p_value\": 0.828125,\n    \"alternative_hypothesis\": \"two-sided\",\n    \"conclusion\": \"在显著性水平0.05下，不拒绝原假设，认为两组样本的中位数无显著差异\"\n}\n```\n\n## 示例2：Wilcoxon符号秩检验（配对样本）\n### 输入\n```python\nbefore_treatment = [80, 85, 90, 78, 82]\nafter_treatment = [82, 88, 92, 80, 85]\nresult = wilcoxon_signed_rank_test(before_treatment, after_treatment)\n```\n### 预期输出\n```json\n{\n    \"test_type\": \"Wilcoxon符号秩检验\",\n    \"statistic\": 0.0,\n    \"p_value\": 0.0625,\n    \"alternative_hypothesis\": \"two-sided\",\n    \"conclusion\": \"在显著性水平0.05下，不拒绝原假设，认为配对样本的中位数无显著差异\"\n}\n```\n\n## 示例3：Kruskal-Wallis H检验（多独立样本）\n### 输入\n```python\ngroup_a = [5, 7, 9, 11, 13]\ngroup_b = [6, 8, 10, 12, 14]\ngroup_c = [4, 6, 8, 10, 12]\nresult = kruskal_wallis_h_test(group_a, group_b, group_c)\n```\n### 预期输出\n```json\n{\n    \"test_type\": \"Kruskal-Wallis H检验\",\n    \"statistic\": 1.2,\n    \"p_value\": 0.5473944375108709,\n    \"alternative_hypothesis\": \"two-sided\",\n    \"conclusion\": \"在显著性水平0.05下，不拒绝原假设，认为所有组样本的中位数无显著差异\"\n}\n```"
}