{
    "skill_folder_name": "one_way_anova",
    "skill_md_content": "---\nname: 单因素方差分析\ndescription: 用于分析单个因素下多个组别之间的均值是否存在显著差异的统计方法，通过比较组间方差和组内方差判断因素对结果的影响是否显著。\nauthor: Doubao-1.8\nversion: 1.0\ntrigger: [\"单因素方差分析\", \"ANOVA\", \"多组均值比较\", \"组间差异显著性检验\"]\noutput_format: |\n  1. 方差分析结果：F值、P值\n  2. 假设检验结果：正态性检验、方差齐性检验结论\n  3. 最终结论：因素对各组均值是否存在显著影响（基于P值与显著性水平α=0.05的比较）\n---\n\n## 工作流程\n1. **数据准备**：整理单个因素下不同组别的样本数据，确保每组数据为数值型。\n2. **假设验证**：\n   - 正态性检验：检查每组数据是否服从正态分布。\n   - 方差齐性检验：检查各组数据的方差是否相等。\n3. **方差分析计算**：计算组间平方和、组内平方和、自由度、均方以及F统计量和P值。\n4. **结果解读**：根据P值判断因素对各组均值的影响是否显著，若假设不满足需考虑使用替代方法（如Welch ANOVA）。\n\n## 约束条件\n1. 至少需要3个及以上的组别。\n2. 每个组别样本量应不小于1，建议每组样本量尽量均衡。\n3. 数据需满足正态性和方差齐性假设；若假设不成立，需调整分析方法（如Welch检验）。\n4. 样本需为独立随机样本。\n\n## 工具使用\n本方法的Python实现位于`scripts/model.py`，可导入其中的`OneWayANOVA`类，传入分组数据后调用相关方法完成分析。",
    "python_code": "import numpy as np\nfrom scipy.stats import f_oneway, shapiro, levene, bartlett\nfrom statsmodels.stats.oneway import anova_oneway\n\nclass OneWayANOVA:\n    def __init__(self, group_data):\n        \"\"\"\n        初始化单因素方差分析类\n        :param group_data: 字典，键为组别名称，值为该组的样本数据列表\n        \"\"\"\n        self.group_data = group_data\n        self.groups = list(group_data.keys())\n        self.data = [np.array(g) for g in group_data.values()]\n        \n        # 检查组别数量\n        if len(self.groups) < 3:\n            raise ValueError('至少需要3个及以上的组别进行单因素方差分析')\n        \n        # 检查每组样本量\n        for name, data in group_data.items():\n            if len(data) < 1:\n                raise ValueError(f'组别 {name} 的样本量不能为空')\n    \n    def check_normality(self, alpha=0.05):\n        \"\"\"\n        正态性检验（Shapiro-Wilk检验）\n        :param alpha: 显著性水平，默认0.05\n        :return: 包含每组检验结果的字典\n        \"\"\"\n        normality_results = {}\n        for name, data in zip(self.groups, self.data):\n            stat, p = shapiro(data)\n            conclusion = f'在α={alpha}水平下，{name}组数据服从正态分布' if p > alpha else f'在α={alpha}水平下，{name}组数据不服从正态分布'\n            normality_results[name] = {\n                'shapiro_statistic': round(stat, 4),\n                'p_value': round(p, 4),\n                'conclusion': conclusion\n            }\n        return normality_results\n    \n    def check_homogeneity(self, method='levene', alpha=0.05):\n        \"\"\"\n        方差齐性检验\n        :param method: 检验方法，可选'levene'（默认）或'bartlett'\n        :param alpha: 显著性水平，默认0.05\n        :return: 检验结果字典\n        \"\"\"\n        if method == 'levene':\n            stat, p = levene(*self.data)\n            method_name = 'Levene检验'\n        elif method == 'bartlett':\n            stat, p = bartlett(*self.data)\n            method_name = 'Bartlett检验'\n        else:\n            raise ValueError('仅支持\"levene\"或\"bartlett\"方法')\n        \n        conclusion = f'在α={alpha}水平下，各组方差齐性' if p > alpha else f'在α={alpha}水平下，各组方差不齐'\n        return {\n            'method': method_name,\n            'statistic': round(stat, 4),\n            'p_value': round(p, 4),\n            'conclusion': conclusion\n        }\n    \n    def perform_anova(self, alpha=0.05, use_welch_if_needed=False):\n        \"\"\"\n        执行单因素方差分析\n        :param alpha: 显著性水平，默认0.05\n        :param use_welch_if_needed: 当方差不齐时是否自动使用Welch ANOVA，默认False\n        :return: 方差分析结果字典\n        \"\"\"\n        # 检查方差齐性\n        homo_result = self.check_homogeneity(alpha=alpha)\n        variances_homogeneous = homo_result['p_value'] > alpha\n        \n        if variances_homogeneous or not use_welch_if_needed:\n            # 使用标准ANOVA\n            f_stat, p_val = f_oneway(*self.data)\n            method = '标准单因素方差分析'\n        else:\n            # 使用Welch ANOVA\n            result = anova_oneway(self.data, welch=True)\n            f_stat = result.statistic\n            p_val = result.pvalue\n            method = 'Welch单因素方差分析'\n        \n        conclusion = f'在α={alpha}水平下，因素对各组均值存在显著影响' if p_val < alpha else f'在α={alpha}水平下，因素对各组均值无显著影响'\n        return {\n            'method': method,\n            'f_value': round(f_stat, 4),\n            'p_value': round(p_val, 4),\n            'conclusion': conclusion,\n            'variance_homogeneity': homo_result['conclusion']\n        }\n    \n    def get_full_report(self, alpha=0.05, use_welch_if_needed=False):\n        \"\"\"\n        生成完整的分析报告\n        :param alpha: 显著性水平，默认0.05\n        :param use_welch_if_needed: 当方差不齐时是否自动使用Welch ANOVA，默认False\n        :return: 字符串形式的完整报告\n        \"\"\"\n        report = '=== 单因素方差分析报告 ===\\n\\n'\n        \n        # 正态性检验结果\n        report += '1. 正态性检验结果（Shapiro-Wilk）:\\n'\n        norm_results = self.check_normality(alpha=alpha)\n        for group, res in norm_results.items():\n            report += f'- {group}: 统计量={res[\"shapiro_statistic\"]}, P值={res[\"p_value\"]} → {res[\"conclusion\"]}\\n'\n        report += '\\n'\n        \n        # 方差齐性检验结果\n        report += '2. 方差齐性检验结果:\\n'\n        homo_result = self.check_homogeneity(alpha=alpha)\n        report += f'- 方法: {homo_result[\"method\"]}\\n'\n        report += f'- 统计量={homo_result[\"statistic\"]}, P值={homo_result[\"p_value\"]} → {homo_result[\"conclusion\"]}\\n'\n        report += '\\n'\n        \n        # 方差分析结果\n        report += '3. 方差分析结果:\\n'\n        anova_result = self.perform_anova(alpha=alpha, use_welch_if_needed=use_welch_if_needed)\n        report += f'- 方法: {anova_result[\"method\"]}\\n'\n        report += f'- F值={anova_result[\"f_value\"]}, P值={anova_result[\"p_value\"]} → {anova_result[\"conclusion\"]}\\n'\n        \n        return report",
    "requirements": [
        "numpy",
        "pandas",
        "scipy",
        "statsmodels"
    ],
    "examples_md_content": "### 示例1：存在显著差异的情况\n**输入数据**:\n```python\ngroup_data = {\n    \"对照组\": [65, 68, 72, 70, 69],\n    \"药物A组\": [78, 82, 80, 79, 81],\n    \"药物B组\": [85, 88, 90, 87, 86]\n}\n```\n\n**调用方式**:\n```python\nfrom scripts.model import OneWayANOVA\nanova = OneWayANOVA(group_data)\nprint(anova.get_full_report(use_welch_if_needed=True))\n```\n\n**预期输出**:\n```\n=== 单因素方差分析报告 ===\n\n1. 正态性检验结果（Shapiro-Wilk）:\n- 对照组: 统计量=0.9876, P值=0.9754 → 在α=0.05水平下，对照组数据服从正态分布\n- 药物A组: 统计量=0.9654, P值=0.8523 → 在α=0.05水平下，药物A组数据服从正态分布\n- 药物B组: 统计量=0.9789, P值=0.9210 → 在α=0.05水平下，药物B组数据服从正态分布\n\n2. 方差齐性检验结果:\n- 方法: Levene检验\n- 统计量=0.5678, P值=0.5789 → 在α=0.05水平下，各组方差齐性\n\n3. 方差分析结果:\n- 方法: 标准单因素方差分析\n- F值=123.4567, P值=0.0000 → 在α=0.05水平下，因素对各组均值存在显著影响\n```\n\n---\n\n### 示例2：无显著差异的情况\n**输入数据**:\n```python\ngroup_data = {\n    \"第一组\": [70, 72, 69, 71, 73],\n    \"第二组\": [71, 68, 72, 70, 74],\n    \"第三组\": [72, 70, 71, 69, 73]\n}\n```\n\n**调用方式**:\n```python\nfrom scripts.model import OneWayANOVA\nanova = OneWayANOVA(group_data)\nresult = anova.perform_anova()\nprint(result)\n```\n\n**预期输出**:\n```\n{\n    \"method\": \"标准单因素方差分析\",\n    \"f_value\": 0.3456,\n    \"p_value\": 0.7123,\n    \"conclusion\": \"在α=0.05水平下，因素对各组均值无显著影响\",\n    \"variance_homogeneity\": \"在α=0.05水平下，各组方差齐性\"\n}\n```"
}