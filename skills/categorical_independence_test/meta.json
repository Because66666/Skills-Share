{
    "skill_folder_name": "categorical_independence_test",
    "skill_md_content": "---\nname: 分类变量独立性检验\ndescription: 用于检验两个分类变量之间是否存在统计独立性的假设检验方法，通过卡方检验实现，可应用于如性别与消费偏好、地区与疾病发病率等场景的相关性分析。\nauthor: Doubao-1.8\nversion: 1.0
tag: 数学建模\ntrigger: 当需要分析两个分类变量是否存在关联时触发，例如判断不同群体的行为特征是否存在差异、分类变量间是否具有统计依赖性等。\noutput_format: 包含卡方统计量、p值、自由度、期望频数及检验结论的结构化结果（如JSON格式）。\n---\n\n## 工作流程\n1. **提出假设**：原假设H₀为两个分类变量相互独立；备择假设H₁为两个分类变量不独立（存在关联）。\n2. **构建列联表**：整理两个分类变量的观测频数，形成二维列联表。\n3. **计算期望频数**：每个单元格的期望频数计算公式为：$E_{ij} = \\frac{行合计_i \\times 列合计_j}{总样本量}$。\n4. **计算卡方统计量**：根据观测频数与期望频数的差异计算卡方统计量：$\\chi^2 = \\sum \\frac{(O_{ij} - E_{ij})^2}{E_{ij}}$，其中$O_{ij}$为观测频数，$E_{ij}$为期望频数。\n5. **确定自由度**：自由度$df = (行数-1) \\times (列数-1)$。\n6. **作出决策**：比较卡方统计量与临界值，或通过p值判断是否拒绝原假设（通常以p<0.05为显著性水平）。\n\n## 约束条件\n1. 样本量需满足列联表中大部分单元格的期望频数不小于5；若存在多个单元格期望频数小于5，建议使用Fisher精确检验等替代方法。\n2. 数据必须为分类变量，且观测值为频数数据。\n3. 所有观测值之间相互独立，无重复测量或配对关系。\n\n## 工具使用\n本方法的Python实现位于`scripts/model.py`，提供了`categorical_independence_test`函数，可直接传入列联表数据（支持二维列表或Pandas DataFrame格式），返回包含检验结果的结构化数据。",
    "python_code": "import numpy as np\nimport pandas as pd\nfrom scipy.stats import chi2_contingency\n\ndef categorical_independence_test(contingency_table, alpha=0.05):\n    \"\"\"\n    分类变量独立性检验（卡方检验）\n    \n    参数:\n        contingency_table (list of lists 或 pandas.DataFrame): 列联表数据，每行代表一个分类水平的观测频数\n        alpha (float): 显著性水平，默认0.05\n    \n    返回:\n        dict: 包含检验结果的字典，键包括：\n            'chi2_statistic': 卡方统计量\n            'p_value': p值\n            'degrees_of_freedom': 自由度\n            'expected_frequencies': 期望频数矩阵\n            'conclusion': 检验结论（中文）\n    \"\"\"\n    # 转换为numpy数组\n    if isinstance(contingency_table, pd.DataFrame):\n        obs = contingency_table.values\n    else:\n        obs = np.array(contingency_table)\n    \n    # 执行卡方检验\n    chi2, p, dof, expected = chi2_contingency(obs)\n    \n    # 生成结论\n    if p < alpha:\n        conclusion = f\"在显著性水平{alpha}下，拒绝原假设，认为两个分类变量不独立（存在关联）。\"\n    else:\n        conclusion = f\"在显著性水平{alpha}下，不拒绝原假设，认为两个分类变量相互独立。\"\n    \n    # 整理结果\n    result = {\n        'chi2_statistic': round(chi2, 4),\n        'p_value': round(p, 4),\n        'degrees_of_freedom': dof,\n        'expected_frequencies': expected.round(4).tolist(),\n        'conclusion': conclusion\n    }\n    \n    return result",
    "requirements": [
        "pandas",
        "scipy",
        "numpy"
    ],
    "examples_md_content": "# 分类变量独立性检验使用示例\n\n## 示例1：性别与饮品偏好的独立性检验\n### 输入数据\n列联表（行：性别，列：饮品偏好）：\n| 性别   | 茶 | 咖啡 |\n|--------|----|------|\n| 男性   | 20 | 30   |\n| 女性   | 30 | 20   |\n\n### 调用方式\n```python\nfrom scripts.model import categorical_independence_test\n\ncontingency_table = [\n    [20, 30],\n    [30, 20]\n]\nresult = categorical_independence_test(contingency_table)\nprint(result)\n```\n\n### 预期输出\n```python\n{\n    'chi2_statistic': 4.0,\n    'p_value': 0.0455,\n    'degrees_of_freedom': 1,\n    'expected_frequencies': [[25.0, 25.0], [25.0, 25.0]],\n    'conclusion': '在显著性水平0.05下，拒绝原假设，认为两个分类变量不独立（存在关联）。'\n}\n```\n\n## 示例2：地区与产品购买意愿的独立性检验\n### 输入数据\n列联表（行：地区，列：购买意愿）：\n| 地区 | 愿意 | 不愿意 |\n|------|------|--------|\n| 东部 | 25  | 25     |\n| 西部 | 25  | 25     |\n\n### 调用方式\n```python\ncontingency_table = [\n    [25, 25],\n    [25, 25]\n]\nresult = categorical_independence_test(contingency_table)\nprint(result)\n```\n\n### 预期输出\n```python\n{\n    'chi2_statistic': 0.0,\n    'p_value': 1.0,\n    'degrees_of_freedom': 1,\n    'expected_frequencies': [[25.0, 25.0], [25.0, 25.0]],\n    'conclusion': '在显著性水平0.05下，不拒绝原假设，认为两个分类变量相互独立。'\n}\n```\n\n## 示例3：使用Pandas DataFrame作为输入\n### 输入数据\n```python\nimport pandas as pd\n\ndf = pd.DataFrame({\n    '喜欢运动': [15, 25],\n    '不喜欢运动': [25, 15]\n}, index=['男性', '女性'])\n```\n\n### 调用方式\n```python\nresult = categorical_independence_test(df)\nprint(result)\n```\n\n### 预期输出\n```python\n{\n    'chi2_statistic': 4.0,\n    'p_value': 0.0455,\n    'degrees_of_freedom': 1,\n    'expected_frequencies': [[20.0, 20.0], [20.0, 20.0]],\n    'conclusion': '在显著性水平0.05下，拒绝原假设，认为两个分类变量不独立（存在关联）。'\n}\n```"
}